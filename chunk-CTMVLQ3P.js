import{$b as j,Ab as R,Ac as J,Bb as V,Bc as Q,Ea as F,F as U,Fa as s,Ga as L,Ha as b,Hc as Y,Ic as W,J as C,Jc as X,K as y,Kc as Z,Nc as ee,Oa as N,Pc as te,Qc as g,Sc as re,Tc as ie,V as m,Vc as h,W as _,Wc as ae,Xa as D,Xc as ne,Yc as oe,Zc as se,_c as le,a as E,bc as P,bd as me,ca as u,cd as ce,da as q,ea as d,na as a,oa as o,pa as f,qc as $,sc as A,ta as M,tc as B,ua as w,va as x,vc as z,wc as G,xb as T,xc as H,y as k,yb as O,zc as K}from"./chunk-HAWMPXUI.js";import{e as v}from"./chunk-BNZU7Q4F.js";var de=(()=>{let l=class l{constructor(){this.supabaseUrl=R.supabaseApiURL,this.supabaseKey=R.supabaseApiKey,this.supabase=V(this.supabaseUrl,this.supabaseKey)}emailExists(e){return new E(r=>{this.supabase.from("UserData").select("email").eq("email",e).then(({data:i,error:c})=>{c?r.error(`Error al consultar los emails: ${c.message}`):(r.next(i.length>0),r.complete())})})}getFavoriteCharacters(e){return new E(r=>{this.supabase.from("favorites").select("*").eq("user_id",e).then(i=>{i.error?r.error(i.error):(r.next(i),r.complete())},i=>{r.error(i)})})}setFavoriteCharacters(e,r){return new E(i=>{this.supabase.from("favorites").select("*").eq("user_id",e).then(Be=>v(this,[Be],function*({data:c,error:p}){if(p)i.error(`Error al consultar la tabla: ${p.message}`);else if(c.length===0){let{data:ue,error:S}=yield this.supabase.from("favorites").upsert([{user_id:e,favorites:r}]);S?i.error(`Error al crear el registro: ${S.message}`):(i.next(),i.complete())}else{let ue=c[0],{data:S,error:I}=yield this.supabase.from("favorites").update({favorites:r}).eq("user_id",e);I?i.error(`Error al actualizar el registro: ${I.message}`):(i.next(),i.complete())}}),c=>{i.error(`Error al consultar la tabla: ${c.message}`)})})}};l.\u0275fac=function(r){return new(r||l)},l.\u0275prov=k({token:l,factory:l.\u0275fac,providedIn:"root"});let t=l;return t})();function ge(t,l){t&1&&(a(0,"mat-error"),s(1," Nombre es "),a(2,"strong"),s(3,"requerido"),o()())}function _e(t,l){t&1&&(a(0,"mat-error"),s(1," Apellido es "),a(2,"strong"),s(3,"requerido"),o()())}function he(t,l){t&1&&(a(0,"mat-error"),s(1," Documento de Identidad es "),a(2,"strong"),s(3,"requerido"),o()())}function xe(t,l){t&1&&(a(0,"mat-error"),s(1," Por favor ingrese un correo v\xE1lido "),o())}function ve(t,l){t&1&&(a(0,"mat-error"),s(1," Correo es "),a(2,"strong"),s(3,"requerido"),o()())}function Ee(t,l){t&1&&(a(0,"mat-error"),s(1," Clave es "),a(2,"strong"),s(3,"requerido"),o()())}function Ce(t,l){if(t&1&&(a(0,"div",23),s(1),o()),t&2){let n=x(2);m(),b(" ",n.messageError," ")}}function ye(t,l){if(t&1){let n=M();a(0,"mat-card-content")(1,"form",8)(2,"div",9)(3,"div",10)(4,"mat-form-field",11)(5,"mat-label"),s(6,"Nombre"),o(),f(7,"input",12),u(8,ge,4,0,"mat-error",13),o()(),a(9,"div",10)(10,"mat-form-field",11)(11,"mat-label"),s(12,"Apellido"),o(),f(13,"input",14),u(14,_e,4,0,"mat-error",13),o()(),a(15,"div",15)(16,"mat-form-field",16)(17,"mat-label"),s(18,"Documento de Identidad"),o(),f(19,"input",17),a(20,"mat-hint",18),s(21),o(),u(22,he,4,0,"mat-error",13),o()(),a(23,"div",15)(24,"mat-form-field",11)(25,"mat-label"),s(26,"Correo"),o(),f(27,"input",19),u(28,xe,2,0,"mat-error",13)(29,ve,4,0,"mat-error",13),o()(),a(30,"div",15)(31,"mat-form-field",11)(32,"mat-label"),s(33,"Clave"),o(),a(34,"input",20),w("keyup.enter",function(){C(n);let r=x();return y(r.createUser())}),o(),u(35,Ee,4,0,"mat-error",13),a(36,"button",21),w("click",function(){C(n);let r=x();return y(r.hide=!r.hide)}),a(37,"mat-icon"),s(38),o()()()()()(),u(39,Ce,2,1,"div",22),o()}if(t&2){let n=x();m(),d("formGroup",n.createUserForm),m(7),d("ngIf",n.name==null?null:n.name.hasError("required")),m(6),d("ngIf",n.last_name==null?null:n.last_name.hasError("required")),m(7),b("",(n.id_document==null?null:n.id_document.value.length)||0,"/10"),m(),d("ngIf",n.id_document==null?null:n.id_document.hasError("required")),m(6),d("ngIf",n.email==null?null:n.email.hasError("email")),m(),d("ngIf",n.email==null?null:n.email.hasError("required")),m(5),d("type",n.hide?"password":"text"),m(),d("ngIf",n.password==null?null:n.password.hasError("required")),m(),q("aria-label","Hide password")("aria-pressed",n.hide),m(2),L(n.hide?"visibility_off":"visibility"),m(),d("ngIf",n.error)}}function we(t,l){t&1&&f(0,"app-loading-spinner")}var Pe=(()=>{let l=class l{get name(){let e=this.createUserForm.get("name");return e!==null?e:null}get last_name(){let e=this.createUserForm.get("last_name");return e!==null?e:null}get id_document(){let e=this.createUserForm.get("id_document");return e!==null?e:null}get email(){let e=this.createUserForm.get("email");return e!==null?e:null}get password(){let e=this.createUserForm.get("password");return e!==null?e:null}constructor(e,r,i,c,p){this.userRegisterService=e,this.formBuilder=r,this.errorService=i,this.router=c,this.supabaseService=p,this.hide=!0,this.isLoading=!0,this.error=!1,this.createUserForm=this.formBuilder.group({name:new h("",[g.required]),last_name:new h("",[g.required]),id_document:new h("",[g.required]),email:new h("",[g.required,g.email]),password:new h("",[g.required])})}ngOnInit(){return v(this,null,function*(){(yield this.userRegisterService.supabase.auth.getUser()).data.user&&this.router.navigate(["/home"])})}createUser(){this.isLoading=!1,this.userRegisterService.signUp(this.email?.value,this.password?.value).subscribe(e=>{this.isLoading=!0,this.errorService.showMessage(`Usuario registrado: ${JSON.stringify(e.email)}, por favor confirmar su correo.`),this.insertDataRow(this.email?.value,this.password?.value)},e=>{this.isLoading=!0,this.error=!0,this.messageError=e.message,this.errorService.showMessage(`Error al registrar usuario: ${e.message}`)})}insertDataRow(e,r){this.userRegisterService.checkUserExistence(e,r).then(i=>{if(i){let c=this.createUserForm.value;this.userRegisterService.insertUser(c).subscribe(()=>{this.errorService.showMessage("Datos del usuario registrados."),this.router.navigate(["/login"])},p=>{this.errorService.showMessage(`Error al registrar datos del usuario: ${p.message}`)})}}).catch(i=>{console.error("Error al verificar la existencia del usuario:",i)})}emailExists(){this.isLoading=!1,this.supabaseService.emailExists(this.email?.value).subscribe(e=>{e?(this.isLoading=!0,this.error=!0,this.messageError=`Error el correo que intenta registrar ${this.email?.value} ya existe.`,this.errorService.showMessage(this.messageError)):this.createUser()})}};l.\u0275fac=function(r){return new(r||l)(_(me),_(le),_($),_(T),_(de))},l.\u0275cmp=U({type:l,selectors:[["app-register-rick-morty"]],decls:17,vars:3,consts:[["content",""],[1,"fondo"],[1,"example-card"],[4,"ngIf","ngIfElse"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"my-2"],[1,"centered-footer"],["routerLink","/login"],[1,"example-form",3,"formGroup"],[1,"row"],[1,"col-md-6"],["appearance","fill",1,"example-full-width"],["formControlName","name","matInput","","placeholder","Ex. John"],[4,"ngIf"],["formControlName","last_name","matInput","","placeholder","Ex. Doe"],[1,"col-md-12"],["hintLabel","Max 10 d\xEDgitos","appearance","fill",1,"example-full-width"],["formControlName","id_document","matInput","","maxlength","10","placeholder","1234567890"],["align","end"],["formControlName","email","type","email","matInput","","placeholder","Ex. pat@example.com"],["formControlName","password","matInput","",3,"keyup.enter","type"],["mat-icon-button","","matSuffix","",3,"click"],["class","alert alert-danger","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-danger"]],template:function(r,i){if(r&1){let c=M();a(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),s(4,"Crea tu cuenta"),o()(),u(5,ye,40,13,"mat-card-content",3),a(6,"mat-card-actions")(7,"button",4),w("click",function(){return C(c),y(i.emailExists())}),s(8," Registrarte "),o()(),f(9,"hr",5),a(10,"mat-card-footer",6)(11,"p"),s(12,"\xBFYa tienes un usuario? "),a(13,"a",7),s(14,"Ingresa aqu\xED"),o()()()()(),u(15,we,1,0,"ng-template",null,0,N)}if(r&2){let c=F(16);m(5),d("ngIf",i.isLoading)("ngIfElse",c),m(2),d("disabled",i.createUserForm.invalid)}},dependencies:[D,A,O,B,z,K,H,Q,J,G,j,P,ce,ee,Y,X,W,Z,ae,te,re,ie,se,ne,oe],styles:['.example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.example-full-width[_ngcontent-%COMP%]{padding-top:.3rem;width:100%}.td-name[_ngcontent-%COMP%]{padding-right:8px}input[_ngcontent-%COMP%]{color:#fff}.example-card[_ngcontent-%COMP%]{min-width:425px;margin:0 auto;margin-bottom:2rem;margin-top:2rem}mat-card-actions[_ngcontent-%COMP%]{margin-left:auto}.fondo[_ngcontent-%COMP%]{background-image:url("./media/fondo-login-L6UNPQO5.jpg");background-size:cover;background-position:center center;background-repeat:no-repeat;height:90vh;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff}.centered-footer[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}']});let t=l;return t})();export{de as a,Pe as b};
